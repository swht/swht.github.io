<!DOCTYPE html>
<html lang="zh-CN">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="南非波波" />



<meta name="description" content="Author:@南非波波
课程大纲：
day07
http://www.cnblogs.com/alex3714/articles/5213184.html
day08
http://www.cnblogs.com/alex3714/articles/5227251.html
###推荐电影###
绝美之城  上帝之城 | 千与千寻  龙猫 卡尔的移动城堡
通过实例私有变量，需要将在类中封装一个方">
<meta property="og:type" content="article">
<meta property="og:title" content="pytho自动化开发 day08">
<meta property="og:url" content="http://blog.songqingbo.cn/2016/03/05/s12-20160305-day08/index.html">
<meta property="og:site_name" content="南非波波博客">
<meta property="og:description" content="Author:@南非波波
课程大纲：
day07
http://www.cnblogs.com/alex3714/articles/5213184.html
day08
http://www.cnblogs.com/alex3714/articles/5227251.html
###推荐电影###
绝美之城  上帝之城 | 千与千寻  龙猫 卡尔的移动城堡
通过实例私有变量，需要将在类中封装一个方">
<meta property="og:updated_time" content="2016-07-04T07:42:37.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="pytho自动化开发 day08">
<meta name="twitter:description" content="Author:@南非波波
课程大纲：
day07
http://www.cnblogs.com/alex3714/articles/5213184.html
day08
http://www.cnblogs.com/alex3714/articles/5227251.html
###推荐电影###
绝美之城  上帝之城 | 千与千寻  龙猫 卡尔的移动城堡
通过实例私有变量，需要将在类中封装一个方">

<link rel="apple-touch-icon" href= "/南非波波.png">


    <link rel="alternate" href="/atom.xml" title="南非波波博客" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>pytho自动化开发 day08 | 南非波波博客</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">南非波波</a></h1>
        </hgroup>

        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false" />
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class='no-result'>No results found <i class='fa fa-spinner fa-pulse'></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:qingbo.song@gmail.com" title="Email"></a>
                            
                                <a class="fa 新浪微博" href="/sina weibo" title="新浪微博"></a>
                            
                                <a class="fa GitHub" href="https://github.com/swht" title="GitHub"></a>
                            
                                <a class="fa V2EX" href="http://www.v2ex.com/member/swht" title="V2EX"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                                <a class="fa 知乎" href="https://www.zhihu.com/people/nanfeibobo" title="知乎"></a>
                            
                                <a class="fa 豆瓣" href="https://www.douban.com/people/swht/" title="豆瓣"></a>
                            
                                <a class="fa 简书" href="http://www.jianshu.com/users/247fb1ce1573/timeline" title="简书"></a>
                            
                                <a class="fa SegmentFault" href="https://segmentfault.com/u/swht" title="SegmentFault"></a>
                            
                                <a class="fa 博客园" href="http://www.cnblogs.com/songqingbo" title="博客园"></a>
                            
                                <a class="fa QQ" href="tencent://message/?uin=1018584989&Site=南非波波&Menu=yes" title="QQ"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python开发之路/">Python开发之路</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">读书、爬山、码代码</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">南非波波</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">南非波波</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:qingbo.song@gmail.com" title="Email"></a>
                            
                                <a class="fa 新浪微博" target="_blank" href="/sina weibo" title="新浪微博"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/swht" title="GitHub"></a>
                            
                                <a class="fa V2EX" target="_blank" href="http://www.v2ex.com/member/swht" title="V2EX"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                                <a class="fa 知乎" target="_blank" href="https://www.zhihu.com/people/nanfeibobo" title="知乎"></a>
                            
                                <a class="fa 豆瓣" target="_blank" href="https://www.douban.com/people/swht/" title="豆瓣"></a>
                            
                                <a class="fa 简书" target="_blank" href="http://www.jianshu.com/users/247fb1ce1573/timeline" title="简书"></a>
                            
                                <a class="fa SegmentFault" target="_blank" href="https://segmentfault.com/u/swht" title="SegmentFault"></a>
                            
                                <a class="fa 博客园" target="_blank" href="http://www.cnblogs.com/songqingbo" title="博客园"></a>
                            
                                <a class="fa QQ" target="_blank" href="tencent://message/?uin=1018584989&Site=南非波波&Menu=yes" title="QQ"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-s12-20160305-day08" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/05/s12-20160305-day08/" class="article-date">
      <time datetime="2016-03-05T07:30:00.000Z" itemprop="datePublished">2016-03-05</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      pytho自动化开发 day08
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        

        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python开发之路/">Python开发之路</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>Author:@南非波波</p>
<p>课程大纲：</p>
<p>day07</p>
<p><a href="http://www.cnblogs.com/alex3714/articles/5213184.html" target="_blank" rel="external">http://www.cnblogs.com/alex3714/articles/5213184.html</a></p>
<p>day08</p>
<p><a href="http://www.cnblogs.com/alex3714/articles/5227251.html" target="_blank" rel="external">http://www.cnblogs.com/alex3714/articles/5227251.html</a></p>
<p>###推荐电影###</p>
<pre><code>绝美之城  上帝之城 | 千与千寻  龙猫 卡尔的移动城堡
</code></pre><p>通过实例私有变量，需要将在类中封装一个方法，该方法返回私有变量的值</p>
<h3 id="一、socket深入"><a href="#一、socket深入" class="headerlink" title="一、socket深入"></a>一、socket深入</h3><p>1.概念</p>
<pre><code>Unix的进程通信机制。一个完整的socket有一个本地唯一的socket号，由操作系统分配。socket是面向客户/服务器模型而设计的，针对客户和服务器程序提供不同的socket系统调用。socket利用客户/服务器模式巧妙的解决了进程之间建立通信连接的问题。

套接字（socket）是通信的基石，是支持TCP/IP协议的网络通信的基本操作单元。它是网络通信过程中端点的抽象表示，包含进行网络通信必须的五种信息：连接使用的协议，本地主机的IP地址，本地进程的协议端口，远地主机的IP地址，远地进程的协议端口。
</code></pre><p>2.地址簇</p>
<pre><code>socket.AF_UNIX unix本机进程间通信 
socket.AF_INET　使用IPV4地址协议进行进程间通信
socket.AF_INET6  使用IPV6地址协议进行进程间通信
</code></pre><p>3.套接字类型</p>
<pre><code>socket.SOCK_STREAM  #使用tcp协议
socket.SOCK_DGRAM   #使用udp协议
socket.SOCK_RAW     #原始套接字，普通的套接字无法处理ICMP、IFMP等网络报文，而SOCK_RAM可以。其次SOCK_RAM也可以处理特殊的IPV4报文,此外，利用原始套接字可以通过IP_HDRINCL套接字选项由用户构造IP头。
socket.SOCK_RDM    #是一种可靠的UDP形式，即保证交付数据报但不保证顺序。SOCK_RAW用来提供对原始协议的低级访问，在需要执行某些特殊操作时使用，如发送ICMP报文。SOCK_RAW通常仅限于高级用户或管理员运行的程序使用。
</code></pre><p>4.socket方法</p>
<pre><code>1. socket.socket(family=AF_INET, type=SOCK_STREAM, proto=0, fileno=None)
2. socket.socketpair([family[, type[, proto]]])
3. socket.create_connection(address[, timeout[, source_address]])
4. socket.getaddrinfo(host, port, family=0, type=0, proto=0, flags=0) 
    获取要连接的对端主机地址
5. sk.bind(address) 
    将套接字绑定到地址，地址的格式取决于地址簇。在AF_INET下，以元组(host.port)的形式表示地址。
6. sk.listen(backlog) 
    开始监听传入的连接，backlog指定在拒绝连接之前，可以挂起的最大连接数量。backlog等于5，表示内核已经连接到连接请求，但服务器还没有调用accept进行处理的连接个数最大为5.这个值根据内核和服务器物理配置进行设置。
7. sk.setblocking(bool) 
    是否阻塞（默认True），如果设置为False，那么accept和recv时一旦无数据则报错。
8. sk.accept() 
    接受连接并返回（conn,address）,其中conn是新的套接字对象，可以用来接收和发送数据，address是连接客户端的地址。接收TCP客户的连接（阻塞式）等待连接的到来。
9. sk.connect(address)
    连接到address处的套接字。一般，address的格式为元组（hostname,port），如果连接出错，返回socket.err错误。
10. sk.connect_ex(address)
    同上，只是会有返回值，连接成功时返回0，连接失败时会返回编码，例如：10061
11. sk.close()
    关闭套接字
12. sk.recv(bufsize[,flag])
    接收套接字的数据，数据以字符串形式返回。bufsize指定最多可以接收的数量，建议不要超过1024*8。flag提供有关消息的其他信息。通常可以忽略。
13. sk.recvfrom(bufsize[.flag])
    与recv()类似，但返回值是（data,address）。其中data是包含接收数据的字符串，address是发送数据的套接字地址
14. sk.send(string[,flag])
    将string中的数据发送到连接的套接字，返回值是要发送的字节数量，该数量可能小于string的字节大小，即：可能未壮指定内容全部发送
15. sk.sendall(string[,flag])
    将string中的数据发送到连接的套接字，但在返回之前会尝试发送所有数据。成功返回None，失败则跑出异常。内部通过递归调用send将所有内容发送出去。
16.    sk.sendto(string[,flag],address)
    将数据发送到套接字，address是形式为（ipaddr，port）的元组，指定远程地址。返回值是发送的字节数。该函数主要用于UDP协议。
17. sk.settimeout(timeout)
    设置套接字操作的超时期，timeout是一个浮点数，单位是秒。值为None表示没有超时期。一般，超时期应该在刚创建套接字时设置，因为它们可能用于连接的操作（如 client 连接最多等待5s ）
18. sk.getpeername()
    返回连接套接字的远程地址。返回值通常是元组（ipaddr,port）
19.    sk.getsockname()
    返回套接字自己的地址，通常在是一个元组（ipaddr,port）
20. socket.gethostname()
    获取程序运行所在计算机的主机名
21.    gethostbyname(name) 
    尝试将给定的主机名解释为一个IP地址。首先将检查当前计算机是否能够解释。如果不能，一个解释请求将发送给一个远程的DNS服务器（远程的DNS服务器 还可能将解释请求转发给另一个DNS服务器，直到该请求可以被处理）。gethostbyname函数返回这个IP地址或在查找失败后引发一个异常。例如： socket.gethostbyname(&apos;www.apicloud.com&apos;)
    扩展形式：socket.gethostbyname_ex(&apos;www.apicloud.com&apos;)
    (&apos;98e86f98d416f10c.7cname.com&apos;, [&apos;www.apicloud.com&apos;], [&apos;117.25.140.17&apos;])
    它返回一个包含三个元素的元组，分别是给定地址的主要的主机名、同一IP地址的可选的主机名的一个列表、关于同一主机的同一接口的其它IP地址的一个列表（列表可能都是空的）。
22. gethostbyaddr(address)
    函数的作用与gethostbyname_ex相同，只是你提供给它的参数是一个IP地址字符串。
    socket.gethostbyaddr(&apos;202.165.102.205&apos;)
    (&apos;homepage.vip.cnb.yahoo.com&apos;, [&apos;www.yahoo.com.cn&apos;], [&apos;202.165.102.205&apos;])
23.    getservbyname(service,protocol)
    函数要求一个服务名（如&apos;telnet&apos;或&apos;ftp&apos;）和一个协议（如&apos;tcp&apos;或&apos;udp&apos;），返回服务所使用的端口号：
    &gt;&gt;&gt; socket.getservbyname(&apos;http&apos;,&apos;tcp&apos;)
    80
    &gt;&gt;&gt; socket.getservbyname(&apos;https&apos;,&apos;tcp&apos;)
    443
    &gt;&gt;&gt; socket.getservbyname(&apos;telnet&apos;,&apos;tcp&apos;)
24.    sk.fileno()
    套接字的文件描述符
    socket.sendfile(file, offset=0, count=None)
    发送文件 ，但目前多数情况下并无什么卵用
</code></pre><h3 id="二、socketserver"><a href="#二、socketserver" class="headerlink" title="二、socketserver"></a>二、socketserver</h3><p>参考链接：<a href="http://my.oschina.net/u/1433482/blog/190612" target="_blank" rel="external">http://my.oschina.net/u/1433482/blog/190612</a></p>
<p>SocketServer简化了网络服务器的编写。它有4个类：TCPServer，UDPServer，UnixStreamServer，UnixDatagramServer。这4个类是同步进行处理的，另外通过ForkingMixIn和ThreadingMixIn类来支持异步。</p>
<p><strong>创建服务器的步骤</strong></p>
<pre><code>首先，你必须创建一个请求处理类，它是BaseRequestHandler的子类并重载其handle()方法。其次，你必须实例化一个服务器类，传入服务器的地址和请求处理程序类。最后，调用handle_request()(一般是调用其他事件循环或者使用select())或serve_forever()。
</code></pre><p><strong>服务器类型</strong></p>
<pre><code>5种类型：BaseServer，TCPServer，UnixStreamServer，UDPServer，UnixDatagramServer。 注意：BaseServer不直接对外服务。
</code></pre><p><strong>服务器对象</strong></p>
<pre><code>class SocketServer.BaseServer：这是模块中的所有服务器对象的超类。它定义了接口，如下所述，但是大多数的方法不实现，在子类中进行细化。

BaseServer.fileno()：返回服务器监听套接字的整数文件描述符。通常用来传递给select.select(), 以允许一个进程监视多个服务器。

BaseServer.handle_request()：处理单个请求。处理顺序：get_request(), verify_request(), process_request()。如果用户提供handle()方法抛出异常，将调用服务器的handle_error()方法。如果self.timeout内没有请求收到， 将调用handle_timeout()并返回handle_request()。

BaseServer.serve_forever(poll_interval=0.5): 处理请求，直到一个明确的shutdown()请求。每poll_interval秒轮询一次shutdown。忽略self.timeout。如果你需要做周期性的任务，建议放置在其他线程。

BaseServer.shutdown()：告诉serve_forever()循环停止并等待其停止。python2.6版本。

BaseServer.address_family: 地址家族，比如socket.AF_INET和socket.AF_UNIX。

BaseServer.RequestHandlerClass：用户提供的请求处理类，这个类为每个请求创建实例。

BaseServer.server_address：服务器侦听的地址。格式根据协议家族地址的各不相同，请参阅socket模块的文档。

BaseServer.socketSocket：服务器上侦听传入的请求socket对象的服务器。

服务器类支持下面的类变量：

BaseServer.allow_reuse_address：服务器是否允许地址的重用。默认为false ，并且可在子类中更改。

BaseServer.request_queue_size

请求队列的大小。如果单个请求需要很长的时间来处理，服务器忙时请求被放置到队列中，最多可以放request_queue_size个。一旦队列已满，来自客户端的请求将得到 “Connection denied”错误。默认值通常为5 ，但可以被子类覆盖。

BaseServer.socket_type：服务器使用的套接字类型; socket.SOCK_STREAM和socket.SOCK_DGRAM等。

BaseServer.timeout：超时时间，以秒为单位，或 None表示没有超时。如果handle_request()在timeout内没有收到请求，将调用handle_timeout()。

下面方法可以被子类重载，它们对服务器对象的外部用户没有影响。

BaseServer.finish_request()：实际处理RequestHandlerClass发起的请求并调用其handle()方法。 常用。

BaseServer.get_request()：接受socket请求，并返回二元组包含要用于与客户端通信的新socket对象，以及客户端的地址。

BaseServer.handle_error(request, client_address)：如果RequestHandlerClass的handle()方法抛出异常时调用。默认操作是打印traceback到标准输出，并继续处理其他请求。

BaseServer.handle_timeout()：超时处理。默认对于forking服务器是收集退出的子进程状态，threading服务器则什么都不做。

BaseServer.process_request(request, client_address) :调用finish_request()创建RequestHandlerClass的实例。如果需要，此功能可以创建新的进程或线程来处理请求,ForkingMixIn和ThreadingMixIn类做到这点。常用。

BaseServer.server_activate()：通过服务器的构造函数来激活服务器。默认的行为只是监听服务器套接字。可重载。

BaseServer.server_bind()：通过服务器的构造函数中调用绑定socket到所需的地址。可重载。

BaseServer.verify_request(request, client_address)：返回一个布尔值，如果该值为True ，则该请求将被处理，反之请求将被拒绝。此功能可以重写来实现对服务器的访问控制。默认的实现始终返回True。client_address可以限定客户端，比如只处理指定ip区间的请求。 常用。
</code></pre><p><strong>请求处理器</strong></p>
<pre><code>处理器接收数据并决定如何操作。它负责在socket层之上实现协议（i.e., HTTP, XML-RPC, or AMQP)，读取数据，处理并写反应。可以重载的方法如下：

setup(): 准备请求处理. 默认什么都不做，StreamRequestHandler中会创建文件类似的对象以读写socket.

handle(): 处理请求。解析传入的请求，处理数据，并发送响应。默认什么都不做。常用变量：self.request，self.client_address，self.server。

finish(): 环境清理。默认什么都不做，如果setup产生异常，不会执行finish。

通常只需要重载handle。self.request的类型和数据报或流的服务不同。对于流服务，self.request是socket 对象；对于数据报服务，self.request是字符串和socket 。可以在子类StreamRequestHandler或DatagramRequestHandler中重载，重写setup()和finish() ，并提供self.rfile和self.wfile属性。 self.rfile和self.wfile可以读取或写入，以获得请求数据或将数据返回到客户端。
</code></pre><p><strong>示例代码</strong></p>
<ol>
<li><p>server</p>
<p>  #!/usr/local/env python3<br>  ‘’’<br>  Author:@南非波波<br>  Blog:<a href="http://www.cnblogs.com/songqingbo/" target="_blank" rel="external">http://www.cnblogs.com/songqingbo/</a><br>  E-mail:qingbo.song@gmail.com<br>  ‘’’<br>  import socketserver</p>
<p>  class MyHandleServer(socketserver.BaseRequestHandler):</p>
<pre><code>&apos;&apos;&apos;
定义一个测试socketserver类
&apos;&apos;&apos;
def handle(self):
    &apos;&apos;&apos;
    定义一个函数，用来处理每个客户端发来的请求
    :return:
    &apos;&apos;&apos;
    print(&quot;新建立一个连接：&quot;,self.client_address)
    while True:
        try:
            client_data = self.request.recv(1024)
            if not client_data:
                print(&quot;客户端发送的数据为空,主动断开!&quot;,self.client_address)
                break
            print(&quot;客户端发来的请求:&quot;,client_data.decode())
            self.request.send(client_data)
        except ConnectionResetError:
            print(&quot;客户端主动断开!&quot;,self.client_address)
            break
</code></pre><p>  if <strong>name</strong> == “<strong>main</strong>“:</p>
<pre><code>HOST,PORT = &quot;127.0.0.1&quot;,5000
server = socketserver.ThreadingTCPServer((HOST,PORT),MyHandleServer)
server.serve_forever()
</code></pre></li>
</ol>
<ol>
<li><p>client</p>
<p>  #!/usr/local/env python3<br>  ‘’’<br>  Author:@南非波波<br>  Blog:<a href="http://www.cnblogs.com/songqingbo/" target="_blank" rel="external">http://www.cnblogs.com/songqingbo/</a><br>  E-mail:qingbo.song@gmail.com<br>  ‘’’<br>  import socket</p>
<p>  ip_port = (“127.0.0.1”,5000)</p>
<p>  sk = socket.socket()<br>  sk.connect(ip_port)<br>  while True:</p>
<pre><code>msg = input(&quot;&gt;&gt;:&quot;).strip()
if not msg:
    break
sk.sendall(bytes(msg,&quot;utf8&quot;))
server_reply = sk.recv(1024)
print(&quot;服务端返回:&quot;,str(server_reply,&quot;utf8&quot;))
</code></pre><p>  sk.close()</p>
</li>
</ol>
<h3 id="三、异常处理"><a href="#三、异常处理" class="headerlink" title="三、异常处理"></a>三、异常处理</h3><p><a href="http://www.cnblogs.com/wupeiqi/articles/5017742.html" target="_blank" rel="external">http://www.cnblogs.com/wupeiqi/articles/5017742.html</a></p>
<ol>
<li><p>异常基础(python3的写法)</p>
<p> 在编程过程中为了增加友好性，在程序出现bug时一般不会将错误信息显示给用户，而是显示一个提示的页面，通俗来说就是不让用户看见代码出错的页面</p>
<pre><code>try:
    pass
except Exception as ex:
    pass
</code></pre></li>
<li><p>异常种类</p>
<p> 常用异常：</p>
<pre><code>AttributeError 试图访问一个对象没有的树形，比如foo.x，但是foo没有属性x
IOError 输入/输出异常；基本上是无法打开文件
ImportError 无法引入模块或包；基本上是路径问题或名称错误
IndentationError 语法错误（的子类） ；代码没有正确对齐
IndexError 下标索引超出序列边界，比如当x只有三个元素，却试图访问x[5]
KeyError 试图访问字典里不存在的键
KeyboardInterrupt Ctrl+C被按下
NameError 使用一个还未被赋予对象的变量
SyntaxError Python代码非法，代码不能编译(个人认为这是语法错误，写错了）
TypeError 传入对象类型与要求的不符合
UnboundLocalError 试图访问一个还未被设置的局部变量，基本上是由于另有一个同名的全局变量，
导致你以为正在访问它
ValueError 传入一个调用者不期望的值，即使值的类型是正确的
</code></pre><p> 更多种类：</p>
<pre><code>ArithmeticError
AssertionError
AttributeError
BaseException
BufferError
BytesWarning
DeprecationWarning
EnvironmentError
EOFError
Exception  #捕获一般的所有异常
FloatingPointError
FutureWarning
GeneratorExit
ImportError  #捕获导入模块异常
ImportWarning
IndentationError
IndexError  #捕获索引异常
IOError  #捕获IO异常
KeyboardInterrupt  #捕获键盘组合键异常
KeyError
LookupError
MemoryError
NameError
NotImplementedError
OSError
OverflowError
PendingDeprecationWarning
ReferenceError
RuntimeError
RuntimeWarning
StandardError
StopIteration
SyntaxError
SyntaxWarning
SystemError
SystemExit
TabError
TypeError
UnboundLocalError
UnicodeDecodeError
UnicodeEncodeError
UnicodeError
UnicodeTranslateError
UnicodeWarning
UserWarning
ValueError
Warning
ZeroDivisionError
</code></pre></li>
<li><p>自定义异常类</p>
<pre><code>#!/usr/local/env python3
&apos;&apos;&apos;
Author:@南非波波
Blog:http://www.cnblogs.com/songqingbo/
E-mail:qingbo.song@gmail.com
&apos;&apos;&apos;
class SwhtError(Exception):
    &apos;&apos;&apos;
    自定义异常
    &apos;&apos;&apos;
    def __init__(self,msg):
        &apos;&apos;&apos;
        初始化函数
        :param msg:用户输入message
        :return:
        &apos;&apos;&apos;
        self.message = msg

    def __str__(self): #名称可以自行定义，只是通过该方法返回message的值
        &apos;&apos;&apos;
        返回用户输入的信息
        :return:
        &apos;&apos;&apos;
        return self.message

try:
    raise SwhtError(&quot;这是一个致命的错误！&quot;)
except Exception as e:
    print(&quot;dsdsd&quot;,e)
</code></pre></li>
<li><p>示例代码：</p>
<pre><code>dic = [&quot;swht&quot;, &apos;shen&apos;]
try:
    dic[10]
except IndexError as e:
    print(&quot;IndexError:&quot;,e)

dic = {&apos;k1&apos;:&apos;v1&apos;}
try:
    dic[&apos;k20&apos;]
except KeyError as e:
    print(&quot;keyError:&quot;,e)

s1 = &apos;hello&apos;
try:
    int(s1)
except ValueError as e:
    print(&quot;ValueError:&quot;,e)
</code></pre></li>
<li><p>特殊异常</p>
<p> 虽然python自带的一个处理万能异常类Exception，但是并不是有一些异常都能被捕获的。如果要想捕获这些特殊的异常，就需要进行自定义异常类</p>
</li>
<li><p>异常其他架构</p>
<pre><code>try:
    # 主代码块
    pass
except KeyError as e:
    # 异常时，执行该块
    pass
else:
    # 主代码块执行完，执行该块
    pass
finally:
    # 无论异常与否，最终执行该块
    pass
</code></pre></li>
<li><p>主动触发异常</p>
<pre><code>try:
    raise Exception(&apos;错误了。。。&apos;)
except Exception as e:
    print(&quot;Error&quot;,e)
</code></pre></li>
<li><p>Asser断言：</p>
<p> 至关重要的判断，强制判断前面的业务结果是否符合要求，否则就抛出异常</p>
<pre><code>a = 1
try:
    assert a == 2
    print(&quot;True&quot;)
except Exception as e:
    print(&quot;False&quot;,e)
</code></pre></li>
</ol>
<h3 id="四、进程与线程"><a href="#四、进程与线程" class="headerlink" title="四、进程与线程"></a>四、进程与线程</h3><ol>
<li><p>概念</p>
<ol>
<li><p>进程</p>
<p>  一个具有一定独立功能的程序关于某个数据集合的一次运行活动，是系统进行资源分配和调度运行的基本单位</p>
</li>
<li><p>线程</p>
<p>  线程是操作系统能够进行运算调度的最小单位。它被包含在进程之中，是进程中的实际运作单位。一条线程指的是进程中一个单一顺序的控制流，一个进程中可以并发多个线程，每条线程并行执行不同的任务</p>
</li>
<li><p>进程与线程的区别</p>
<ol>
<li><p>进程是一个动态的概念</p>
<p>进程是程序的一次执行过程，是动态概念</p>
<p>程序是一组有序的指令集和，是静态概念</p>
</li>
<li><p>不同的进程可以执行同一个程序</p>
<p>区分进程的条件：所执行的程序和数据集合。</p>
<p>两个进程即使执行在相同的程序上，只要他们运行在不同的数据集合上，他们也是两个进程。例如：多个用户同时调用同一个编译程序编译他们编写的C语言源程序，由于编译程序运行在不同的数据集合（不同的C语言源程序）上，于是产生了一个个不同的进程</p>
</li>
<li><p>每个进程都有自己的生命周期</p>
<p>当操作系统要完成某个任务时，它会创建一个进程。当进程完成任务之后，系统就会撤销这个进程，收回它所占用的资源。从创建到撤销的时间段就是进程的生命期</p>
</li>
<li><p>进程之间存在并发性</p>
<p>在一个系统中，同时会存在多个进程。他们轮流占用CPU和各种资源</p>
</li>
<li><p>进程间会相互制约</p>
<p>进程是系统中资源分配和运行调度的单位，在对资源的共享和竞争中，必然相互制约，影响各自向前推进的速度</p>
</li>
<li><p>进程可以创建子进程，程序不能创建子程序</p>
</li>
<li><p>从结构上讲，每个进程都由程序、数据和一个进程控制块（Process Control Block, PCB）组成</p>
</li>
</ol>
</li>
</ol>
</li>
<li><p>进程锁</p>
<p>Python threading模块</p>
<ol>
<li>线程的两种调用方式<ol>
<li>直接调用</li>
<li>继承式调用</li>
</ol>
</li>
<li>join&amp;&amp;Demo</li>
<li>线程锁<ol>
<li>互斥锁：同时仅且只有一个线程在运行</li>
<li>共享锁：同时可以有多个线程共同运行，可以实现一个线程池的效果</li>
<li>递归锁</li>
<li>Semaphore(信号量)</li>
</ol>
</li>
<li></li>
</ol>
</li>
</ol>
<p>示例代码：</p>
<pre><code>#!/usr/local/env python3

import threading,time

def addNum():
    global num #声明修改全局变量
    print(&quot;--get num:&quot;,num)
    time.sleep(1)
    lock.acquire()
    num -=1
    lock.release()

lock = threading.Lock()
num = 100
threading_list = []
for i in range(2040):
    t = threading.Thread(target=addNum)
    t.start()
    threading_list.append(t)
for t in threading_list: #等待所有线程执行完毕
    t.join()

print(&quot;num:&quot;,num)
</code></pre><p>event</p>
<p>多进程</p>
<p>进程间通讯</p>
<pre><code>队列
管道
manager
    Manager 所有的子进程和父进程之间都能进行数据的共享
    Manager 是一个安全的进程管理池，不需要加进程锁
</code></pre><p>进程同步</p>
<p>进程池</p>
<pre><code>开启一个进程的系统开销太大，设置进程池限制启动的进程数，以达到保护系统的目的。另外在线程池内的进程可以实现同步或异步调用。
</code></pre>
      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2016/03/05/s12-20160305-day08/">pytho自动化开发 day08</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">南非波波</a></p>
        <p><span>发布时间:</span>2016-03-05, 15:30:00</p>
        <p><span>最后更新:</span>2016-07-04, 15:42:37</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2016/03/05/s12-20160305-day08/" title="pytho自动化开发 day08">http://blog.songqingbo.cn/2016/03/05/s12-20160305-day08/</a>
            <span class="copy-path" data-clipboard-text="原文: http://blog.songqingbo.cn/2016/03/05/s12-20160305-day08/　　作者: 南非波波" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2016/03/12/s12-20160312-day09/">
                    pytho自动化开发 day09
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2016/02/27/s12-20160227-day07/">
                    pytho自动化开发 day07
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#一、socket深入"><span class="toc-number">1.</span> <span class="toc-text">一、socket深入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#二、socketserver"><span class="toc-number">2.</span> <span class="toc-text">二、socketserver</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#三、异常处理"><span class="toc-number">3.</span> <span class="toc-text">三、异常处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#四、进程与线程"><span class="toc-number">4.</span> <span class="toc-text">四、进程与线程</span></a></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"pytho自动化开发 day08　| 南非波波博客　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    
      <div class="duoshuo" id="comments">
    <div id="comment-box" ></div>
    <div class="ds-thread" id="ds-thread" data-thread-key="2016/03/05/s12-20160305-day08/" data-title="pytho自动化开发 day08" data-url="http://blog.songqingbo.cn/2016/03/05/s12-20160305-day08/"></div>
    <script>
        var duoshuoQuery = {short_name:"nanfeibobo"};
        var loadComment = function(){
            var d = document, s = d.createElement('script');
            s.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
            s.async = true; s.charset = 'UTF-8';
            (d.head || d.body).appendChild(s);
        }

        
    </script>
    
    <script> loadComment(); </script>

</div>
    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2016/03/12/s12-20160312-day09/" title="上一篇: pytho自动化开发 day09">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2016/02/27/s12-20160227-day07/" title="下一篇: pytho自动化开发 day07">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/05/14/s12-20160514-day17/">pytho自动化开发 day17</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/07/s12-20160507-day16/">pytho自动化开发 day16</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/30/s12-20160430-day15/">pytho自动化开发 day15</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/21/s12-20160421-day14/">pytho自动化开发 day14</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/09/s12-20160409-day13/">pytho自动化开发 day13</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/19/s12-20160319-day10/">pytho自动化开发 day10</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/12/s12-20160312-day09/">pytho自动化开发 day09</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/05/s12-20160305-day08/">pytho自动化开发 day08</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/27/s12-20160227-day07/">pytho自动化开发 day07</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/20/s12-20160130-day06/">pytho自动化开发 day06</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/30/s12-20160130-day05/">pytho自动化开发 day05</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/23/s12-20160123-day04/">pytho自动化开发 day04</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/16/s12-20160116-day03/">pytho自动化开发 day03</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/09/s12-20160109-day02/">pytho自动化开发 day02</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/16/s12-20151226-day01/">pytho自动化开发 day01</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016  <a href="https://github.com/swht" target="_blank" title="南非波波github主页">南非波波</a>
            </div>
            <div class="footer-right">
                <a href="http://www.cnblogs.com/songqingbo/" target="_blank" title="南非波波博客园主页">南非波波博客园主页</a>            
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" >本站到访数: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="/js/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>